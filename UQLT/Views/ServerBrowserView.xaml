<UserControl x:Class="UQLT.Views.ServerBrowserView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:helpers="clr-namespace:UQLT.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="423" d:DesignWidth="1040">

    <UserControl.Resources>
        <!--Template for Red/Blue Team Colors-->
        <DataTemplate x:Key="TeamColors">
            <TextBlock Text="{Binding team_name}"/>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding team}" Value="1">
                    <Setter Property="TextBlock.Foreground" Value="Red"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding team}" Value="2">
                    <Setter Property="TextBlock.Foreground" Value="Blue"/>
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>
        <!--Template for displaying proper score formatting (i.e. Race times)-->
        <DataTemplate x:Key="ScoreTemplate">
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding Converter="{StaticResource ScoreToRace}">
                        <Binding Path="player_game_type"/>
                        <Binding Path="score"/>
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>
        <!--Template for displaying extended server details-->
        <DataTemplate x:Key="extendedDetailsTemplate">

            <StackPanel Margin="12,0,0,0">
                <StackPanel Orientation="Vertical">
                    <Image Name="MapImage" Width="112" Height="84" Source="{Binding map_image}" Margin="0,0,0,0"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Map: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding Path=map_title}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Location: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding location_name}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Ping: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding ping}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Mode: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding game_type_title}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding game_type, Converter={StaticResource GameTypeToRound}}" FontWeight="Bold"/>
                        <TextBlock Text="{Binding roundlimit}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Game Status: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding formatted_game_state}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Time Left: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding time_remaining}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Players: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding totalplayers}"/>
                    </StackPanel>
                    <StackPanel x:Name="TeamScoreboard" Orientation="Vertical" Margin="0,10,5,5">

                        <TextBlock FontWeight="Bold" HorizontalAlignment="Center">
                                Team Scoreboard
                                <LineBreak/>
                        </TextBlock>

                        <StackPanel x:Name="RedScore" Orientation="Horizontal">
                            <TextBlock Text="Red " FontWeight="Bold"/>
                            <TextBlock Text="{Binding red_team_elo, StringFormat='({0} Elo): '}"/>
                            <TextBlock Text="{Binding g_redscore}"/>
                        </StackPanel>

                        <StackPanel x:Name="BlueScore" Orientation="Horizontal">
                            <TextBlock Text="Blue " FontWeight="Bold"/>
                            <TextBlock Text="{Binding blue_team_elo, StringFormat='({0} Elo): '}"/>
                            <TextBlock Text="{Binding g_bluescore}"/>
                        </StackPanel>
                    </StackPanel>

                </StackPanel>
            </StackPanel>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding is_team_game}" Value="False">
                    <Setter TargetName="TeamScoreboard" Property="Visibility" Value="Hidden"/>
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>
    </UserControl.Resources>


    <Grid Width="1040">
        <Grid.RowDefinitions>
            <RowDefinition Height="210*"/>
            <RowDefinition Height="210*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="770*"/>
            <ColumnDefinition Width="270*"/>
        </Grid.ColumnDefinitions>

        <!--Server Details-->
        <ListView x:Name="SBServerDetails" helpers:GridViewSort.AutoSort="True" HorizontalAlignment="Left" Width="770" IsSynchronizedWithCurrentItem="True" BorderThickness="0" SelectionMode="Single" SelectedIndex="0" ItemsSource="{Binding Servers}" SelectedItem="{Binding SelectedServer}">

            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Location" helpers:GridViewSort.PropertyName="location_name">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="FlagImage" Width="16" Height="11" Source="{Binding flag_image}" Margin="0,0,5,0"/>
                                    <!--<TextBlock Name="CountryName" Text="{Binding location_id, Converter={StaticResource LocIdToName}}"/>-->
                                    <TextBlock Name="CountryName" Text="{Binding location_name}"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Ping" helpers:GridViewSort.PropertyName="ping" DisplayMemberBinding="{Binding ping}"/>

                    <GridViewColumn Header="Game Type" helpers:GridViewSort.PropertyName="game_type_title">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="GameTypeImage" Width="16" Height="16" Margin="0,0,3,0" Source="{Binding gametype_image}"/>
                                    <TextBlock Name="GameTypeName" Text="{Binding game_type_title}"/>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Map" helpers:GridViewSort.PropertyName="map" DisplayMemberBinding="{Binding map}"/>
                    <GridViewColumn Header="Players" helpers:GridViewSort.PropertyName="totalplayers">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding totalplayers}" TextDecorations="Underline" Foreground="Green" Cursor="Hand"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Server Name" helpers:GridViewSort.PropertyName="host_name" DisplayMemberBinding="{Binding host_name}"/>

                    <GridViewColumn Header="Modded" helpers:GridViewSort.PropertyName="modded" DisplayMemberBinding="{Binding modded}"/>
                    <GridViewColumn Header="Instagib" helpers:GridViewSort.PropertyName="instagib" DisplayMemberBinding="{Binding instagib}"/>
                    <GridViewColumn Header="Id" helpers:GridViewSort.PropertyName="public_id" DisplayMemberBinding="{Binding public_id}"/>
                    <GridViewColumn Header="Address" helpers:GridViewSort.PropertyName="host_address" DisplayMemberBinding="{Binding host_address}"/>
                </GridView>
            </ListView.View>
        </ListView>
        <!--Player Details-->
        <ListView x:Name="SBPlayerDetails" helpers:GridViewSort.AutoSort="True" HorizontalAlignment="Left" Height="210" VerticalAlignment="Top" Width="770"
                  IsSynchronizedWithCurrentItem="True" ItemsSource="{Binding SelectedServer.FormattedPlayerList}" SelectionMode="Single" Grid.Row="1">

            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Team" helpers:GridViewSort.PropertyName="team" CellTemplate="{StaticResource TeamColors}"/>
                    <GridViewColumn Header="Clan" helpers:GridViewSort.PropertyName="clan" DisplayMemberBinding="{Binding cleaned_clan}"/>
                    <GridViewColumn Header="Name" helpers:GridViewSort.PropertyName="name">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Name="AcctTypeImage" Width="36" Height="12" Source="{Binding account_image}" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding name}"/>
                                </StackPanel>
                            </DataTemplate>

                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Score" helpers:GridViewSort.PropertyName="score" CellTemplate="{StaticResource ScoreTemplate}"/>

                    <GridViewColumn Header="Elo" helpers:GridViewSort.PropertyName="player_elo" DisplayMemberBinding="{Binding player_elo}"/>

                </GridView>
            </ListView.View>
        </ListView>
        <!--Extended server details-->
        <ContentControl x:Name="SBExtendedInfo" Content="{Binding SelectedServer}" ContentTemplate="{StaticResource extendedDetailsTemplate}" HorizontalAlignment="Left" VerticalAlignment="Top" Grid.Column="1" Height="420" Width="270" Grid.RowSpan="2"/>
    </Grid>
</UserControl>
